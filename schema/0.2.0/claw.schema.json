{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/angelgalvisc/clawkernel/blob/main/schema/0.2.0/claw.schema.json",
  "title": "CKP Claw Manifest",
  "description": "Root manifest schema for Claw Kernel Protocol v0.2.0. Composes all primitives into a complete agent definition. Section 6.",
  "type": "object",
  "properties": {
    "claw": { "$ref": "definitions.schema.json#/$defs/protocolVersion" },
    "kind": { "const": "Claw" },
    "metadata": {
      "type": "object",
      "properties": {
        "name": { "$ref": "definitions.schema.json#/$defs/kebabName" },
        "version": { "$ref": "definitions.schema.json#/$defs/semver" },
        "description": { "type": "string" },
        "labels": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        },
        "annotations": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": ["name"]
    },
    "spec": {
      "type": "object",
      "properties": {
        "identity": {
          "description": "REQUIRED. File path, claw:// URI, or inline Identity primitive.",
          "oneOf": [
            { "type": "string", "minLength": 1 },
            {
              "type": "object",
              "properties": {
                "inline": {
                  "type": "object",
                  "properties": {
                    "personality": { "type": "string", "minLength": 1 },
                    "context_files": { "type": "object", "additionalProperties": { "type": "string" } },
                    "locale": { "type": "string" },
                    "capabilities": { "type": "array", "items": { "type": "string" } },
                    "autonomy": { "type": "string", "enum": ["observer", "supervised", "autonomous"] }
                  },
                  "required": ["personality"]
                }
              },
              "required": ["inline"]
            }
          ]
        },
        "providers": {
          "type": "array",
          "minItems": 1,
          "items": {
            "oneOf": [
              { "type": "string", "minLength": 1 },
              {
                "type": "object",
                "properties": {
                  "inline": {
                    "type": "object",
                    "properties": {
                      "name": { "type": "string" },
                      "protocol": { "type": "string", "enum": ["openai-compatible", "anthropic-native", "custom"] },
                      "endpoint": { "type": "string", "format": "uri" },
                      "model": { "type": "string", "minLength": 1 },
                      "auth": {
                        "type": "object",
                        "properties": {
                          "type": { "type": "string", "enum": ["bearer", "api-key-header", "oauth2", "none"] },
                          "secret_ref": { "type": "string" }
                        },
                        "required": ["type"]
                      },
                      "streaming": { "type": "boolean" },
                      "hints": { "type": "object" },
                      "fallback": { "type": "array" },
                      "limits": { "type": "object" },
                      "retry": { "type": "object" }
                    },
                    "required": ["protocol", "endpoint", "model", "auth"]
                  }
                },
                "required": ["inline"]
              }
            ]
          },
          "description": "REQUIRED. At least one Provider."
        },
        "channels": {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string", "minLength": 1 },
              { "type": "object" }
            ]
          }
        },
        "tools": {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string", "minLength": 1 },
              { "type": "object" }
            ]
          }
        },
        "skills": {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string", "minLength": 1 },
              { "type": "object" }
            ]
          }
        },
        "memory": {
          "oneOf": [
            { "type": "string", "minLength": 1 },
            { "type": "object" }
          ]
        },
        "sandbox": {
          "oneOf": [
            { "type": "string", "minLength": 1 },
            { "type": "object" }
          ]
        },
        "policies": {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string", "minLength": 1 },
              { "type": "object" }
            ]
          }
        },
        "swarm": {
          "oneOf": [
            { "type": "string", "minLength": 1 },
            { "type": "object" }
          ]
        }
      },
      "required": ["identity", "providers"],
      "additionalProperties": false
    }
  },
  "required": ["claw", "kind", "metadata", "spec"],
  "additionalProperties": false
}
